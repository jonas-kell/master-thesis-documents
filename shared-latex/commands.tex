%! Ref-Commands 
\newcommand*{\fullref}[1]{\hyperref[{#1}]{\textit{\autoref*{#1} \nameref*{#1}}}}
\newcommand*{\fullpage}[1]{\hyperref[{#1}]{Seite \pageref*{#1}}}
\newcommand*{\fullpages}[1]{\hyperref[{#1}]{Seiten \pageref*{#1}ff}}

%! Math operators and other small conveniences
\newcommand\thickbar[1]{\accentset{\rule{.6em}{.8pt}}{#1}}
\DeclareMathOperator{\ggt}{ggT}
\DeclareMathOperator{\kgv}{kgV}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\renewcommand*{\arraystretch}{0.8}

\newcommand{\filepath}[2]{\colorbox{lgrey}{#1: \texttt{#2}}\xspace}

%! replace German quotation marks with English ones (I always write the left and right quotes explicitly with the German command variants as they are nice to debug and already in my macros. Then in the end, I can swap them with the desired replacement quotes of my choice)
\renewcommand*{\glqq}{``}
\renewcommand*{\grqq}{''}

\newcommand{\bigo}[1]{\ensuremath{\mathcal{O}(#1)}}


%! qm commands
\newcommand{\up}{\ensuremath{\uparrow}\xspace}
\newcommand{\down}{\ensuremath{\downarrow}\xspace}

\newcommand{\difft}[1]{\ensuremath{\frac{\text{d}#1}{\text{d}t}}\xspace}

\newcommand{\schroedingerPicture}{\text{S}}
\newcommand{\interactionPicture}{\text{I}}
\newcommand{\heisenbergPicture}{\text{H}}

\newcommand{\generalop}[7]{\ensuremath{\hat{\text{#1}}^{#2\xspace #3}_{#4#5#6}#7}\xspace}
\newcommand{\withspinop}[4][]{\generalop{c}{#4}{#1}{#2}{,\,}{#3}{}}
\newcommand{\withspinhcop}[4][]{\generalop{h}{#4}{#1}{#2}{,\,}{#3}{}}
\newcommand{\cop}[3][]{\generalop{c}{#3}{#1}{#2}{}{}{}}
\newcommand{\bop}[3][]{\generalop{b}{#3}{#1}{#2}{}{}{}}
\newcommand{\hop}[3][]{\generalop{h}{#3}{#1}{#2}{}{}{}}
\newcommand{\dop}[3][]{\generalop{d}{#3}{#1}{#2}{}{}{}}
\newcommand{\nop}[3][]{\generalop{n}{}{#1}{#2}{,\,}{#3}{}}
\newcommand{\Aop}[1][]{\generalop{A}{}{#1}{}{}{}{}}
\newcommand{\Bop}[1][]{\generalop{B}{}{#1}{}{}{}{}}
\newcommand{\pauli}[2][]{\generalop{$\sigma$}{\text{#2}}{}{#1}{}{}{}}
\newcommand{\ObservableOp}{\generalop{$\mathcal{O}$}{}{}{}{}{}{}}
\newcommand{\copOfT}[3][]{\generalop{c}{#3}{#1}{#2}{}{}{(t)}}
\newcommand{\hopOfT}[3][]{\generalop{h}{#3}{#1}{#2}{}{}{(t)}}
\newcommand{\dopOfT}[3][]{\generalop{d}{#3}{#1}{#2}{}{}{(t)}}
\newcommand{\nopOfT}[3][]{\generalop{n}{}{#1}{#2}{,\,}{#3}{(t)}}
\newcommand{\AopOfT}[1][]{\generalop{A}{}{#1}{}{}{}{(t)}}
\newcommand{\localObservable}[2]{\ensuremath{{\ObservableOp}_\text{loc}(#1,\,#2)}\xspace}
\newcommand{\doubleOccupationOperator}[1]{\ensuremath{{\ObservableOp}_\text{do}(#1)}\xspace}
\newcommand{\singleOccupationOperator}[2]{\ensuremath{{\ObservableOp}_\text{so}(#1,\,#2)}\xspace}
\newcommand{\spinPolarizedKineticsOperator}[3]{\ensuremath{{\ObservableOp}_\text{sp-kin}(#1 \leftrightarrow #2,\,#3)}\xspace}
\newcommand{\spinPolarizedKineticsOperatorDir}[3]{\ensuremath{{\ObservableOp}_\text{sp-kin, dir}(#1 \rightarrow #2,\,#3)}\xspace}
\newcommand{\one}[1][]{\ensuremath{\mathbbm{1}_{#1}}\xspace}


\newcommand{\hamiltonian}{\ensuremath{\mathcal{H}}\xspace}
\newcommand{\pictureHamiltonian}[1][]{\ensuremath{\hamiltonian^{#1}}\xspace}
\newcommand{\Vhamiltonian}[1][]{\ensuremath{\hat{\text{V}}^{#1}}\xspace}
\newcommand{\HzeroHamiltonian}[1][]{\ensuremath{\hamiltonian_0^{#1}}\xspace}
\newcommand{\VhamiltonianOf}[2][]{\ensuremath{\hat{\text{V}}^{#1}(#2)}\xspace}
\newcommand{\VhamiltonianOfT}[1][]{\VhamiltonianOf[#1]{t}}
\newcommand{\HNOft}[1][N]{\ensuremath{\hamiltonian_{#1}(t)}\xspace}
\newcommand{\HNOftOrder}[2][N]{\ensuremath{\hamiltonian_{#1}^{#2}(t)}\xspace}
\newcommand{\Heff}[3]{\ensuremath{{\hamiltonian_\text{eff}}^{#3}({#1}#2)}\xspace}
\newcommand{\HeffOft}[1][N]{\Heff{#1}{,\,t}{}}
\newcommand{\HeffOftStar}[1][N]{\Heff{#1}{,\,t}{\ast}}
\newcommand{\VhamiltonianPartA}[2]{\ensuremath{\hat{\text{V}}_\text{Part A}\left(#1,\,#2\right)}\xspace}
\newcommand{\VhamiltonianPartB}[2]{\ensuremath{\hat{\text{V}}_\text{Part B}\left(#1,\,#2\right)}\xspace}
\newcommand{\VhamiltonianPartC}[2]{\ensuremath{\hat{\text{V}}_\text{Part C}\left(#1,\,#2\right)}\xspace}
\newcommand{\VhamiltonianOperatorPart}[4][]{\ensuremath{\hat{\text{F}}^{#1}_\text{#2}\left(#3,\,#4\right)}\xspace}
\newcommand{\VhamiltonianAnalyticalPart}[5][]{\ensuremath{\Lambda^{#1}_\text{#2}\left(#3,\,#4,\,#5\right)}\xspace}
\newcommand{\VhamiltonianAnalyticalPartIntegrated}[5][]{\ensuremath{\Pi^{#1}_\text{#2}\left(#3,\,#4,\,#5\right)}\xspace}

\newcommand{\timeOrderingOperator}{\ensuremath{\mathbb{T}}\xspace}
\newcommand{\timeEvolutionOperator}[1][]{\ensuremath{\hat{\text{P}}^{#1}(t)}\xspace}

\newcommand{\lsum}[1][l]{\ensuremath{\sum\limits_{#1}}\xspace}
\newcommand{\neighborsum}[3][]{\ensuremath{\sum\limits_{\left\langle#2, #3\right\rangle#1}}\xspace}
\newcommand{\neighborsumWSpin}[3]{\neighborsum[,\,#3]{#1}{#2}}
\newcommand{\fullneighborsum}[3][]{\ensuremath{\sum\limits_{\left[#2, #3\right]#1}}\xspace}

\newcommand{\epsl}[1][l]{\ensuremath{\varepsilon_{#1}}\xspace}
\newcommand{\ueps}[3]{\ensuremath{\tilde{U}_\text{#1}\left(#2,\,#3\right)}\xspace}

\newcommand{\picturePsi}[2][]{\ensuremath{\varPsi^{#1}{#2}}\xspace}
\newcommand{\psiN}[1][N]{\ensuremath{\varPsi_{#1}}\xspace}
\newcommand{\psiNStar}[1][N]{\ensuremath{\varPsi^\ast_{#1}}\xspace}
\newcommand{\brapsi}[2][]{\ensuremath{\bra{\picturePsi[#1]{#2}}}\xspace}
\newcommand{\ketpsi}[2][]{\ensuremath{\ket{\picturePsi[#1]{#2}}}\xspace}
\newcommand{\brapsiof}[2][]{\brapsi[#1]{(#2)}}
\newcommand{\ketpsiof}[2][]{\ketpsi[#1]{(#2)}}
\newcommand{\psiOfT}[1][]{\ensuremath{\picturePsi[#1]{}(t)}\xspace}
\newcommand{\braketHelper}[2]{\ensuremath{\braket{#1}{#2}}\xspace}
\newcommand{\bracketHelper}[3]{\ensuremath{\matrixel{#1}{#2}{#3}}\xspace}

\newcommand{\braN}[1][N]{\ensuremath{\bra{#1}}\xspace}
\newcommand{\ketN}[1][N]{\ensuremath{\ket{#1}}\xspace}

\newcommand{\absSquare}[1]{\ensuremath{{\left\vert{#1}\right\vert}^2}\xspace}
\newcommand{\timeExpectationVal}[1]{\ensuremath{{\left\langle {#1}\right\rangle}_{(t)}}\xspace}
\newcommand{\probabilityOf}[2]{\ensuremath{\text{P}(#1,\,#2)}\xspace}

\newcommand{\equivalentOperator}{\ensuremath{\hat{=}}\xspace}
\newcommand{\interactionTimeEvolution}[1]{\ensuremath{\left\{#1\right\}^{\interactionPicture}(t)}\xspace}
\newcommand{\heisenbergTimeEvolution}[1]{\ensuremath{\left\{#1\right\}^{\heisenbergPicture}(t)}\xspace}
\newcommand{\discreteGradient}{\ensuremath{\vec{\grad}_\text{disc}}\xspace}
\newcommand{\generaljvecop}[4]{\ensuremath{\vec{j}_{#2,\,#3}^{\,\,#1}#4}\xspace}
\newcommand{\currentvec}[3][]{\generaljvecop{#1}{#2}{#3}{}}
\newcommand{\currentvecOft}[3][]{\generaljvecop{#1}{#2}{#3}{(t)}}
\newcommand{\biggerNeighbor}[2]{\ensuremath{\left\langle#1 \stackrel{+}{<} #2\right\rangle}\xspace}
\newcommand{\smallerNeighbor}[2]{\ensuremath{\left\langle#1 \stackrel{+}{>} #2\right\rangle}\xspace}

\newcommand{\partialTrace}[2]{\ensuremath{\text{Tr}_{#1}\left(#2\right)}\xspace}

\DeclareRobustCommand{\Chi}{{\mathpalette\irchi\relax}}
\newcommand{\irchi}[2]{\raisebox{\depth}{$#1\chi$}} % inner command, used by \rchi

\let\oldtilde\tilde
\newcommand{\tildetilde}[1]{{\smash[b]{\overset{
    \mathchoice {\approx}% doesn't do anything in any of my formulas
                {\approx}% doesn't do anything in any of my formulas
                {   \vphantom{\raisebox{0pt}{\scaleobj{0.3}{\approx}}}
                    \smash{\raisebox{-3.0pt}{\scaleobj{1.1}{\approx}}}
                }
                {   \vphantom{\raisebox{0pt}{\scaleobj{0.3}{\approx}}}
                    \smash{\raisebox{-1.5pt}{\scaleobj{0.6}{\approx}}}
                }
    }{#1}}}}
\renewcommand{\tilde}[1]{{\smash[b]{\overset{
    \mathchoice {\sim} % doesn't do anything in any of my formulas
                {\sim} % doesn't do anything in any of my formulas
                {   \vphantom{\raisebox{0pt}{\scaleobj{0.22}{\sim}}}
                    \smash{\raisebox{-3.4pt}{\scaleobj{1.1}{\sim}}}
                }
                {   \vphantom{\raisebox{0pt}{\scaleobj{0.22}{\sim}}}
                    \smash{\raisebox{-1.9pt}{\scaleobj{0.6}{\sim}}}
                }
    }{#1}}}}

\newcommand{\energyOft}[1][t]{\ensuremath{E\left(#1\right)}\xspace}
\newcommand{\varianceOft}{\ensuremath{\text{Var}_E(t)}\xspace}